<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½• - ä¸“æ³¨åŠ›è®­ç»ƒç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #0a0e27;
            background-image: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=2071&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            position: relative;
            overflow: hidden;
        }
        
        /* èƒŒæ™¯è’™å±‚ï¼Œæé«˜è¡¨å•å¯è¯»æ€§ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 39, 0.3);
            pointer-events: none;
            z-index: 1;
        }
        .login-container {
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.5), 0 0 30px rgba(102, 126, 234, 0.2);
            width: 400px;
            max-width: 90%;
            position: relative;
            z-index: 10;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .login-title {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }
        .btn-login {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px;
            font-size: 18px;
            border-radius: 10px;
            width: 100%;
            margin-top: 10px;
        }
        .btn-login:hover {
            opacity: 0.9;
        }
        .form-control {
            border-radius: 10px;
            padding: 12px;
            font-size: 16px;
        }
        .switch-mode {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }
        .switch-mode a {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
        }
        
        /* éªŒè¯ç æ ·å¼ */
        .captcha-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .captcha-input {
            flex: 1;
        }
        
        .captcha-img {
            height: 48px;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .captcha-img:hover {
            transform: scale(1.05);
        }
        
        .captcha-refresh {
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .captcha-refresh:hover {
            transform: rotate(180deg);
        }
        
        /* å„¿ç«¥å‹å¥½æç¤ºæ¡†æ ·å¼ */
        .kid-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            animation: fadeIn 0.3s ease;
        }
        
        .kid-modal-overlay.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .kid-modal {
            background: white;
            border-radius: 25px;
            padding: 35px;
            max-width: 90%;
            width: 420px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
            animation: bounceIn 0.5s ease;
            text-align: center;
        }
        
        .kid-modal-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: pulse 1s infinite;
        }
        
        .kid-modal-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .kid-modal-message {
            font-size: 20px;
            line-height: 1.6;
            color: #555;
            margin-bottom: 25px;
        }
        
        .kid-modal-button {
            padding: 12px 40px;
            font-size: 20px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .kid-modal-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .kid-modal-button:active {
            transform: translateY(0);
        }
        
        /* ä¸åŒç±»å‹çš„é¢œè‰² */
        .kid-modal.success .kid-modal-title { color: #28a745; }
        .kid-modal.success .kid-modal-button { 
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        
        .kid-modal.error .kid-modal-title { color: #dc3545; }
        .kid-modal.error .kid-modal-button { 
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            color: white;
        }
        
        .kid-modal.warning .kid-modal-title { color: #ffc107; }
        .kid-modal.warning .kid-modal-button { 
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: white;
        }
        
        .kid-modal.info .kid-modal-title { color: #17a2b8; }
        .kid-modal.info .kid-modal-button { 
            background: linear-gradient(135deg, #17a2b8 0%, #007bff 100%);
            color: white;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }
        
        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .login-container {
                padding: 30px 20px;
                width: 100%;
                max-width: 100%;
            }
            
            .login-title {
                font-size: 28px;
            }
            
            .form-control {
                padding: 10px;
                font-size: 15px;
            }
            
            .btn-login {
                padding: 10px;
                font-size: 16px;
            }
        }
        
        @media (max-width: 480px) {
            .login-container {
                padding: 25px 15px;
            }
            
            .login-title {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- å„¿ç«¥å‹å¥½æç¤ºæ¡† -->
    <div id="kidModalOverlay" class="kid-modal-overlay" onclick="closeKidModal(event)">
        <div class="kid-modal" id="kidModal">
            <div class="kid-modal-icon" id="kidModalIcon"></div>
            <div class="kid-modal-title" id="kidModalTitle"></div>
            <div class="kid-modal-message" id="kidModalMessage"></div>
            <button class="kid-modal-button" id="kidModalButton" onclick="closeKidModal()"></button>
        </div>
    </div>
    
    <div class="login-container">
        <div class="login-title">ğŸ¯ ä¸“æ³¨åŠ›è®­ç»ƒç³»ç»Ÿ</div>
        
        <!-- ç™»å½•è¡¨å• -->
        <div id="loginForm">
            <div class="mb-3">
                <label class="form-label">ç”¨æˆ·å</label>
                <input type="text" class="form-control" id="loginUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
            </div>
            <div class="mb-3">
                <label class="form-label">å¯†ç </label>
                <input type="password" class="form-control" id="loginPassword" placeholder="è¯·è¾“å…¥å¯†ç ">
            </div>
            <div class="mb-3">
                <label class="form-label">éªŒè¯ç </label>
                <div class="captcha-container">
                    <input type="text" class="form-control captcha-input" id="loginCaptcha" placeholder="è¯·è¾“å…¥éªŒè¯ç " maxlength="6">
                    <img id="loginCaptchaImg" class="captcha-img" src="" alt="éªŒè¯ç " onclick="refreshLoginCaptcha()">
                    <button type="button" class="btn btn-sm btn-outline-secondary captcha-refresh" onclick="refreshLoginCaptcha()" title="åˆ·æ–°éªŒè¯ç ">
                        ğŸ”„
                    </button>
                </div>
            </div>
            <button class="btn btn-login" onclick="login()">ç™»å½•</button>
            <div class="switch-mode">
                è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ<a href="#" onclick="showRegister()">ç«‹å³æ³¨å†Œ</a>
            </div>
        </div>

        <!-- æ³¨å†Œè¡¨å• -->
        <div id="registerForm" style="display: none;">
            <div class="mb-3">
                <label class="form-label">ç”¨æˆ·å</label>
                <input type="text" class="form-control" id="registerUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
            </div>
            <div class="mb-3">
                <label class="form-label">å¯†ç </label>
                <input type="password" class="form-control" id="registerPassword" placeholder="è¯·è¾“å…¥å¯†ç ">
            </div>
            <div class="mb-3">
                <label class="form-label">æ€§åˆ« <span class="text-danger">*</span></label>
                <select class="form-control" id="registerGender">
                    <option value="">è¯·é€‰æ‹©æ€§åˆ«</option>
                    <option value="ç”·">ç”·</option>
                    <option value="å¥³">å¥³</option>
                    <option value="å…¶ä»–">å…¶ä»–</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">å¹´é¾„ <span class="text-danger">*</span></label>
                <input type="number" class="form-control" id="registerAge" placeholder="è¯·è¾“å…¥å¹´é¾„" min="1" max="120">
            </div>
            <div class="mb-3">
                <label class="form-label">é‚®ç®±ï¼ˆå¯é€‰ï¼‰</label>
                <input type="email" class="form-control" id="registerEmail" placeholder="è¯·è¾“å…¥é‚®ç®±">
            </div>
            <div class="mb-3">
                <label class="form-label">éªŒè¯ç </label>
                <div class="captcha-container">
                    <input type="text" class="form-control captcha-input" id="registerCaptcha" placeholder="è¯·è¾“å…¥éªŒè¯ç " maxlength="6">
                    <img id="registerCaptchaImg" class="captcha-img" src="" alt="éªŒè¯ç " onclick="refreshRegisterCaptcha()">
                    <button type="button" class="btn btn-sm btn-outline-secondary captcha-refresh" onclick="refreshRegisterCaptcha()" title="åˆ·æ–°éªŒè¯ç ">
                        ğŸ”„
                    </button>
                </div>
            </div>
            <button class="btn btn-login" onclick="register()">æ³¨å†Œ</button>
            <div class="switch-mode">
                å·²æœ‰è´¦å·ï¼Ÿ<a href="#" onclick="showLogin()">ç«‹å³ç™»å½•</a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // å„¿ç«¥å‹å¥½æç¤ºæ¡†å‡½æ•°
        function showKidModal(type, message, title) {
            const overlay = document.getElementById('kidModalOverlay');
            const modal = document.getElementById('kidModal');
            const icon = document.getElementById('kidModalIcon');
            const titleEl = document.getElementById('kidModalTitle');
            const messageEl = document.getElementById('kidModalMessage');
            const button = document.getElementById('kidModalButton');
            
            // æ¸…é™¤ä¹‹å‰çš„ç±»å‹
            modal.className = 'kid-modal';
            
            // æ ¹æ®ç±»å‹è®¾ç½®å›¾æ ‡ã€æ ‡é¢˜å’ŒæŒ‰é’®æ–‡å­—
            switch(type) {
                case 'success':
                    icon.textContent = 'âœ…';
                    titleEl.textContent = title || 'å¤ªæ£’å•¦ï¼';
                    button.textContent = 'çŸ¥é“å•¦ï¼';
                    modal.classList.add('success');
                    break;
                case 'error':
                    icon.textContent = 'âŒ';
                    titleEl.textContent = title || 'å“å‘€ï¼';
                    button.textContent = 'æˆ‘æ˜ç™½äº†';
                    modal.classList.add('error');
                    break;
                case 'warning':
                    icon.textContent = 'âš ï¸';
                    titleEl.textContent = title || 'æ³¨æ„å“¦ï¼';
                    button.textContent = 'å¥½çš„';
                    modal.classList.add('warning');
                    break;
                case 'info':
                    icon.textContent = 'ğŸ’¡';
                    titleEl.textContent = title || 'æç¤º';
                    button.textContent = 'æˆ‘çŸ¥é“äº†';
                    modal.classList.add('info');
                    break;
            }
            
            messageEl.textContent = message;
            overlay.classList.add('show');
        }
        
        function closeKidModal(event) {
            if (event && event.target.id !== 'kidModalOverlay' && event.target.id !== 'kidModalButton') {
                return;
            }
            const overlay = document.getElementById('kidModalOverlay');
            overlay.classList.remove('show');
        }
        
        // é¡µé¢åŠ è½½æ—¶åŠ è½½éªŒè¯ç 
        window.onload = function() {
            refreshLoginCaptcha();
        };
        
        // åˆ·æ–°ç™»å½•éªŒè¯ç 
        async function refreshLoginCaptcha() {
            try {
                const response = await fetch('/api/captcha/generate');
                const result = await response.json();
                if (result.status === 'SUCCESS') {
                    document.getElementById('loginCaptchaImg').src = result.data.image;
                }
            } catch (error) {
                console.error('åŠ è½½éªŒè¯ç å¤±è´¥:', error);
            }
        }
        
        // åˆ·æ–°æ³¨å†ŒéªŒè¯ç 
        async function refreshRegisterCaptcha() {
            try {
                const response = await fetch('/api/captcha/generate');
                const result = await response.json();
                if (result.status === 'SUCCESS') {
                    document.getElementById('registerCaptchaImg').src = result.data.image;
                }
            } catch (error) {
                console.error('åŠ è½½éªŒè¯ç å¤±è´¥:', error);
            }
        }
        
        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            // åˆ‡æ¢åˆ°æ³¨å†Œè¡¨å•æ—¶åŠ è½½éªŒè¯ç 
            refreshRegisterCaptcha();
        }

        function showLogin() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            // åˆ‡æ¢åˆ°ç™»å½•è¡¨å•æ—¶åˆ·æ–°éªŒè¯ç 
            refreshLoginCaptcha();
        }

        async function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const captcha = document.getElementById('loginCaptcha').value;

            if (!username || !password) {
                showKidModal('warning', 'è¯·å…ˆè¾“å…¥ä½ çš„ç”¨æˆ·åå’Œå¯†ç å“¦ï¼');
                return;
            }
            
            if (!captcha) {
                showKidModal('warning', 'åˆ«å¿˜äº†è¾“å…¥éªŒè¯ç å“¦ï¼');
                return;
            }

            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username, password, captcha})
                });

                const data = await response.json();
                
                if (data.status === 'SUCCESS') {
                    if (data.data.role === 'ADMIN') {
                        window.location.href = '/admin.html';
                    } else {
                        window.location.href = '/index.html';
                    }
                } else {
                    showKidModal('error', data.message);
                    // éªŒè¯å¤±è´¥ååˆ·æ–°éªŒè¯ç 
                    refreshLoginCaptcha();
                    document.getElementById('loginCaptcha').value = '';
                }
            } catch (error) {
                showKidModal('error', 'ç™»å½•å¤±è´¥å•¦ï¼Œè¯·å†è¯•ä¸€æ¬¡å§ï¼');
                refreshLoginCaptcha();
            }
        }

        async function register() {
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const gender = document.getElementById('registerGender').value;
            const age = document.getElementById('registerAge').value;
            const email = document.getElementById('registerEmail').value;
            const captcha = document.getElementById('registerCaptcha').value;

            if (!username || !password) {
                showKidModal('warning', 'è¯·å…ˆè¾“å…¥ä½ çš„ç”¨æˆ·åå’Œå¯†ç å“¦ï¼');
                return;
            }
            
            if (!gender) {
                showKidModal('warning', 'è¯·é€‰æ‹©ä½ çš„æ€§åˆ«å“¦ï¼');
                return;
            }
            
            if (!age) {
                showKidModal('warning', 'è¯·å‘Šè¯‰æˆ‘ä»¬ä½ çš„å¹´é¾„å“¦ï¼');
                return;
            }
            
            const ageNum = parseInt(age);
            if (isNaN(ageNum) || ageNum < 1 || ageNum > 120) {
                showKidModal('warning', 'å¹´é¾„è¦åœ¨1-120ä¹‹é—´å“¦ï¼');
                return;
            }
            
            if (!captcha) {
                showKidModal('warning', 'åˆ«å¿˜äº†è¾“å…¥éªŒè¯ç å“¦ï¼');
                return;
            }

            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username, password, gender, age, email, captcha})
                });

                const data = await response.json();
                
                if (data.status === 'SUCCESS') {
                    showKidModal('success', 'æ³¨å†ŒæˆåŠŸå•¦ï¼ç°åœ¨å¯ä»¥ç™»å½•äº†ï¼', 'æ¬¢è¿åŠ å…¥ï¼');
                    setTimeout(() => {
                        showLogin();
                        closeKidModal();
                    }, 2000);
                } else {
                    showKidModal('error', data.message);
                    // éªŒè¯å¤±è´¥ååˆ·æ–°éªŒè¯ç 
                    refreshRegisterCaptcha();
                    document.getElementById('registerCaptcha').value = '';
                }
            } catch (error) {
                showKidModal('error', 'æ³¨å†Œå¤±è´¥å•¦ï¼Œè¯·å†è¯•ä¸€æ¬¡å§ï¼');
                refreshRegisterCaptcha();
            }
        }

        // å›è½¦ç™»å½•
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                if (document.getElementById('loginForm').style.display !== 'none') {
                    login();
                } else {
                    register();
                }
            }
        });
    </script>
</body>
</html>
